---
{"dg-publish":true,"permalink":"/project/setting/Home Server/DNS/ICANN 인증/"}
---


# [2025-09-25] 서버 문제 해결 기록: ICANN 인증부터 Docker Nginx 재시작까지

## 1. 최초 문제 발생: ICANN 도메인 정지

### 증상
- `leafy.wolyong.cloud`를 포함한 모든 서브도메인 접속 시 ICANN 도메인 정지 안내 페이지가 나타남.

### 원인
- 도메인 등록 시 사용한 소유자 이메일 주소의 인증 절차를 완료하지 않음.
- ICANN 정책에 따라 등록 기관(Registrar)에서 도메인을 일시적으로 정지시킴.

### ✅ 해결 과정
1.  도메인을 구매한 사이트에 로그인.
2.  도메인 관리 메뉴에서 소유자 정보의 이메일 주소를 확인하고, **인증 메일 재전송**을 요청.
3.  수신된 메일의 **인증 링크를 클릭**하여 인증 절차 완료.

---

## 2. 2차 문제 발생: HTTP 접속 시 정지 페이지 잔존

### 증상
- 이메일 인증 완료 후, `https://...` 로는 정상 접속되지만 `http://...` 로 접속하면 여전히 정지 페이지가 나타남.
- 처음에는 모든 서브도메인에서 발생했으나, 나중에는 `leafy.wolyong.cloud` 에서만 문제가 발생함.

### 🕵️ 문제 해결을 위한 추적 과정

#### 가설 1: DNS 캐시 문제
- **진단**: PC, 공유기, 통신사의 DNS 캐시가 갱신되지 않았을 것으로 추측. 스마트폰의 모바일 데이터(LTE)로 접속하여 테스트.
- **결과**: 모바일 데이터에서도 동일한 현상 발생. **캐시 문제가 아님을 확인.**

#### 가설 2: 도메인 등록 기관의 DNS 설정 문제
- **진단**: 등록 기관 측에서 DNS 정보를 불완전하게 복구했을 가능성. `dnschecker.org`와 같은 외부 DNS 조회 툴로 A 레코드를 확인.
- **결과**: 문제가 발생하는 `leafy.wolyong.cloud`와 정상적인 다른 서브도메인의 IP 주소가 **동일하게** 나옴. **DNS 문제가 아님을 확인.**

#### 가설 3: 서버 Nginx 설정 문제
- **진단**: `leafy.wolyong.cloud`의 Nginx 설정 블록에만 문제가 있을 것으로 추측.
- **확인**: `nginx.conf` 파일의 `server_name` 오타, 리다이렉션 규칙 등을 여러 번 확인했으나 이상 없음.

#### 가설 4: Docker 볼륨 설정 문제
- **진단**: 호스트(`homeserver`)의 `nginx.conf` 파일이 Nginx 컨테이너 내부로 제대로 전달되지 않았을 가능성.
- **확인**: `docker exec nginx_proxy cat /etc/nginx/nginx.conf` 명령어로 컨테이너 내부의 설정 파일을 직접 확인.
- **결과**: 호스트의 설정 파일과 **동일한 내용이 들어있음을 확인.** 볼륨 연결은 정상.

#### 가설 5: 호스트 서버의 포트 충돌 문제
- **진단**: 호스트 서버에 다른 웹서버(Nginx, Apache 등)가 설치되어 80번 포트를 선점하고, `leafy` 도메인 요청만 가로채는 것으로 추측.
- **확인**: `sudo lsof -i :80` 명령어로 80번 포트를 사용하는 프로세스를 확인.
- **결과**: `docker-proxy` 외에 80번 포트를 사용하는 다른 프로세스가 **없음을 확인.** 포트 충돌 문제 아님.

---

## 3. 최종 해결

### ✅ 원인
- 실행 중인 Nginx 컨테이너가 어떤 이유로든 이전에 적용했던 **'문제가 있던' 설정 일부를 메모리에 계속 붙들고 있었던 것**으로 추정.
- `docker-compose up`이나 `reload`로는 해결되지 않는 프로세스 꼬임 현상.

### 🎉 해결 방법
- `docker-compose.yml` 파일이 있는 `~/deploy` 디렉토리에서 아래 명령어를 실행.

```bash
docker-compose restart nginx_proxy